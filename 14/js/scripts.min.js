class URLShortener{constructor(e){this.APILink="https://rel.ink/api/links/",this.urlInput=e,this.url=this.validateURL(this.urlInput.value),this.url?this.handleURL():this.handleForm().message("Please add a link")}validateURL(e){const t=/^(?:(https?):\/\/)?(?:www\.)?([a-z0-9\-]+\.\w+\.?\w+)\/?([\w\-\._~:\/?#[\]@!\$&'\(\)\*\+,;=.]+)?$/gi.exec(e),{1:r="http",2:s,3:n}={...t};return t&&`${r}://${s}${void 0===n?"":"/"+n}`}useAPI(e){const t=new XMLHttpRequest;t.open(e,this.APILink,!0),t.setRequestHeader("Content-Type","application/json; charset=utf-8");const r=new Promise((e,r)=>{t.onreadystatechange=(()=>{4===t.readyState&&t.status>=200&&t.status<300&&e(JSON.parse(t.response))}),t.ontimeout=(()=>r(new Error("Czas został przekroczony"))),t.onerror=(()=>r(new Error("Wystąpił błąd")))});return t.send(JSON.stringify({url:this.url})),r}handleURL(){!!localStorage.getItem(this.url)?this.handleForm().message("You already shorten this link.","info"):this.useAPI("POST").then(({hashid:e})=>{localStorage.setItem(this.url,JSON.stringify({hashid:e,created:(new Date).toJSON()})),URLShortener.displayLinks(),this.handleForm().clear()}).catch(e=>console.log(e))}static displayLinks(){const e=document.querySelector(".links");e.innerHTML="",Object.keys(localStorage).sort((e,t)=>{const r=new Date(JSON.parse(localStorage.getItem(e)).created);return new Date(JSON.parse(localStorage.getItem(t)).created)-r}).forEach(t=>{const r=JSON.parse(localStorage.getItem(t)),s=document.createElement("div");s.classList.add("links__item");const n=document.createElement("h3");n.classList.add("links__full-url"),n.textContent=t,s.appendChild(n);const a=document.createElement("a");a.classList.add("links__shortened-url"),a.textContent=`https://rel.ink/${r.hashid}`,a.setAttribute("href",`https://rel.ink/${r.hashid}`),a.setAttribute("target","_blank"),a.setAttribute("rel","noopener noreferrer"),s.appendChild(a);const o=document.createElement("button");o.classList.add("button","button--primary","button--small"),o.textContent="Copy",o.addEventListener("click",e=>URLShortener.copyLink(e.target,`https://rel.ink/${r.hashid}`)),s.appendChild(o),e.appendChild(s)})}handleForm(){const e=document.querySelector(".message"),t=this;return{clear(){this.clearMessage(),t.urlInput.value=""},message(r,s="error"){this.clearMessage(),"error"===s?(e.classList.add("message--error"),e.textContent=r,t.urlInput.classList.add("form__input--error")):"info"===s&&(e.classList.add("message--info"),e.textContent=r)},clearMessage(){e.setAttribute("class","message"),t.urlInput.classList.remove("form__input--error")}}}static copyLink(e,t){navigator.clipboard.writeText(t),e.classList.add("button--copied"),e.textContent="Copied",setInterval(()=>{e.classList.remove("button--copied"),e.textContent="Copy"},3e3)}}const form=document.querySelector(".form"),urlInput=form.querySelector('[name="url"]');URLShortener.displayLinks(),form.addEventListener("submit",e=>{e.preventDefault(),new URLShortener(urlInput)});const hamburgerButton=document.querySelector(".hamburger"),navigation=document.querySelector(".navigation");hamburgerButton.addEventListener("click",()=>{hamburgerButton.classList.toggle("hamburger--active"),navigation.classList.toggle("navigation--active")});